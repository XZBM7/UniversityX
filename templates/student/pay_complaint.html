{% extends "student/base.html" %}

{% block content %}
<style>
    .payment-container {
        max-width: 800px;
        margin: 40px auto;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
    }

    .payment-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }

    .payment-header {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .payment-header h3 {
        margin: 0;
        font-weight: 600;
        font-size: 1.5rem;
    }

    .complaint-id {
        background: rgba(255, 255, 255, 0.9);
        color: #27ae60;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .payment-body {
        padding: 30px;
    }

    .progress-steps {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin-bottom: 40px;
    }

    .progress-steps::before {
        content: '';
        position: absolute;
        top: 15px;
        left: 10%;
        right: 10%;
        height: 2px;
        background: #e0e0e0;
        z-index: 1;
    }

    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 2;
    }

    .step-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #2ecc71;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
    }

    .step.incomplete .step-icon {
        background: #bdc3c7;
    }

    .step-label {
        font-size: 0.8rem;
        color: #7f8c8d;
    }

    .step.active .step-label {
        color: #2ecc71;
        font-weight: 500;
    }

    .payment-summary {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        background: #f9f9f9;
    }

    .payment-summary h5 {
        text-align: center;
        margin-bottom: 20px;
        color: #2c3e50;
        font-weight: 600;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .summary-total {
        border-top: 1px solid #e0e0e0;
        padding-top: 10px;
        margin-top: 10px;
        font-size: 1.1rem;
        color: #27ae60;
        font-weight: 600;
    }

    .payment-methods {
        margin-bottom: 25px;
    }

    .payment-methods h5 {
        margin-bottom: 15px;
        color: #2c3e50;
        font-weight: 600;
    }

    .method-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .method-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .method-card:hover {
        border-color: #2ecc71;
    }

    .method-card.active {
        border: 2px solid #2ecc71;
        background: #f0fff4;
    }

    .method-card label {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
    }

    .method-icons {
        display: flex;
        margin-bottom: 10px;
    }

    .method-icons i {
        font-size: 1.8rem;
        margin: 0 5px;
    }

    .fa-cc-visa {
        color: #1a1f71;
    }

    .fa-cc-mastercard {
        color: #eb001b;
    }

    .fa-cc-paypal {
        color: #003087;
    }

    .payment-form {
        margin-bottom: 25px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #2c3e50;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 1rem;
        transition: border 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #2ecc71;
    }

    .input-group {
        display: flex;
        align-items: center;
    }

    .input-group .form-control {
        flex: 1;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .input-group-append {
        padding: 12px 15px;
        background: #f5f5f5;
        border: 1px solid #e0e0e0;
        border-left: none;
        border-radius: 0 6px 6px 0;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .terms-check {
        display: flex;
        align-items: center;
        margin: 25px 0;
    }

    .terms-check input {
        margin-right: 10px;
    }

    .terms-link {
        color: #2ecc71;
        text-decoration: none;
        font-weight: 500;
    }

    .terms-link:hover {
        text-decoration: underline;
    }

    .submit-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .submit-btn:hover {
        background: linear-gradient(135deg, #27ae60, #219653);
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .submit-btn i {
        margin-right: 10px;
    }

    .back-link {
        display: inline-block;
        margin-top: 20px;
        color: #7f8c8d;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .back-link:hover {
        color: #2ecc71;
    }

    .back-link i {
        margin-right: 5px;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 8px;
        width: 90%;
        max-width: 700px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
    }

    .modal-header h5 {
        margin: 0;
        font-size: 1.3rem;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        float: right;
        color: #7f8c8d;
    }

    .modal-body {
        padding: 20px;
        max-height: 60vh;
        overflow-y: auto;
    }

    .modal-body ol {
        padding-left: 20px;
    }

    .modal-body li {
        margin-bottom: 10px;
    }

    .modal-footer {
        padding: 15px 20px;
        border-top: 1px solid #e0e0e0;
        text-align: right;
    }

    .modal-btn {
        padding: 8px 20px;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        .method-options {
            grid-template-columns: 1fr;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .payment-container {
            margin: 20px;
        }
    }
</style>

<div class="payment-container">
    <div class="payment-card">
        <div class="payment-header">
            <h3>Complaint Payment</h3>
            <span class="complaint-id">ID: #{{ complaint._id|string|truncate(8, True, '') }}</span>
        </div>

        <div class="payment-body">
            <div class="progress-steps">
                <div class="step active">
                    <div class="step-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <span class="step-label">Submitted</span>
                </div>
                <div class="step active">
                    <div class="step-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <span class="step-label">Payment</span>
                </div>
                <div class="step incomplete">
                    <div class="step-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <span class="step-label">Review</span>
                </div>
            </div>

            <div class="payment-summary">
                <h5>Payment Summary</h5>
                <div class="summary-row">
                    <span>Complaint Fee:</span>
                    <strong>$50.00 EGP</strong>
                </div>
                <div class="summary-row">
                    <span>Processing Fee:</span>
                    <strong>$10.00 EGP</strong>
                </div>
                <div class="summary-row summary-total">
                    <span>Total:</span>
                    <span>60.00 EGP</span>
                </div>
            </div>

            <form method="POST">
                <input type="hidden" name="selected_method" id="selectedMethod" value="credit_card">

                <div class="payment-methods">
                    <h5>Select Payment Method</h5>
                    <div class="method-options">
                        <div class="method-card active" id="creditCardOption">
                            <label>
                                <div class="method-icons">
                                    <i class="fab fa-cc-visa"></i>
                                    <i class="fab fa-cc-mastercard"></i>
                                </div>
                                <div>Credit Card</div>
                                <input type="radio" name="paymentMethod" checked style="display: none;">
                            </label>
                        </div>
                        <div class="method-card" id="paypalOption">
                            <label>
                                <div class="method-icons">
                                    <i class="fab fa-cc-paypal"></i>
                                </div>
                                <div>PayPal</div>
                                <input type="radio" name="paymentMethod" style="display: none;">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="payment-form" id="creditCardForm">
                    <div class="form-group">
                        <label class="form-label">Card Number</label>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="1234 5678 9012 3456" maxlength="16"
                                pattern="\d{16}">
                            <span class="input-group-append"><i class="fas fa-credit-card"></i></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Expiration Date</label>
                            <input type="text" class="form-control" placeholder="MM/YY">
                        </div>
                        <div class="form-group">
                            <label class="form-label">CVV</label>
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="123" maxlength="3" pattern="\d{3}">
                                <span class="input-group-append" title="3-digit code on the back">
                                    <i class="fas fa-question-circle"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-form" id="paypalForm" style="display: none;">
                    <div class="info-notice">
                        <i class="fas fa-info-circle"></i> You'll be redirected to PayPal to complete payment.
                    </div>
                </div>

                <div class="terms-check">
                    <input type="checkbox" id="termsCheck" required>
                    <label for="termsCheck">
                        I agree to the <a href="#" id="termsLink" class="terms-link">Terms and Conditions</a>
                    </label>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-lock"></i> Pay 60.00 EGP Now
                </button>
            </form>

            <a href="{{ url_for('student.complaints') }}" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Complaints
            </a>
        </div>
    </div>
</div>

<div class="modal-overlay" id="termsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h5>Terms and Conditions</h5>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <ol>
                <li>All payments are non-refundable.</li>
                <li>Complaints are reviewed after payment confirmation.</li>
                <li>Ensure accuracy of submitted details before payment.</li>
                <li>Processing may take up to 14 days.</li>
                <li>The university reserves the right to reject complaints that don't meet requirements.</li>
                <li>Personal data will be processed in accordance with our privacy policy.</li>
            </ol>
        </div>
        <div class="modal-footer">
            <button class="modal-btn" id="modalCloseBtn">I Understand</button>
        </div>
    </div>
</div>

<script>
    const creditCardOption = document.getElementById('creditCardOption');
    const paypalOption = document.getElementById('paypalOption');
    const creditCardForm = document.getElementById('creditCardForm');
    const paypalForm = document.getElementById('paypalForm');
    const selectedMethod = document.getElementById('selectedMethod');

    creditCardOption.addEventListener('click', () => {
        creditCardOption.classList.add('active');
        paypalOption.classList.remove('active');
        creditCardForm.style.display = 'block';
        paypalForm.style.display = 'none';
        selectedMethod.value = 'credit_card';
    });

    paypalOption.addEventListener('click', () => {
        paypalOption.classList.add('active');
        creditCardOption.classList.remove('active');
        paypalForm.style.display = 'block';
        creditCardForm.style.display = 'none';
        selectedMethod.value = 'paypal';
    });

    const termsLink = document.getElementById('termsLink');
    const termsModal = document.getElementById('termsModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');

    termsLink.addEventListener('click', (e) => {
        e.preventDefault();
        termsModal.classList.add('active');
    });

    modalCloseBtn.addEventListener('click', () => {
        termsModal.classList.remove('active');
    });

    termsModal.addEventListener('click', (e) => {
        if (e.target === termsModal) {
            termsModal.classList.remove('active');
        }
    });
</script>
{% endblock %}