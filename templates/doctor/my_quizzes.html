{% extends "doctor/base.html" %}

{% block title %}My Quizzes - Dr. {{ session['user']['name'] }}{% endblock %}

{% block extra_css %}
<style>
  .quizzes-container {
    background: white;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin: 2rem auto;
    max-width: 1200px;
  }

  .quizzes-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
  }

  .quizzes-title {
    color: #166088;
    margin-bottom: 0.5rem;
  }

  .quizzes-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
  }

  .quizzes-table th {
    background-color: #4a6fa5;
    color: white;
    padding: 1rem;
    text-align: left;
  }

  .quizzes-table td {
    padding: 1rem;
    border-bottom: 1px solid #eee;
  }

  .quizzes-table tr:hover {
    background-color: rgba(74, 111, 165, 0.05);
  }

  .quiz-status {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .status-upcoming {
    background-color: rgba(52, 152, 219, 0.2);
    color: #3498db;
  }

  .status-active {
    background-color: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
  }

  .status-ended {
    background-color: rgba(149, 165, 166, 0.2);
    color: #666;
  }

  .action-links {
    display: flex;
    gap: 1rem;
  }

  .action-link {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    color: #4a6fa5;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .action-link:hover {
    color: #3a5a80;
    text-decoration: underline;
  }

  .empty-quizzes {
    text-align: center;
    padding: 2rem;
    color: #666;
  }

  .empty-icon {
    font-size: 2rem;
    color: #ddd;
    margin-bottom: 1rem;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
    color: #4a6fa5;
    text-decoration: none;
    font-weight: 600;
  }

  .back-link:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .quizzes-container {
      padding: 1rem;
    }

    .quizzes-table {
      display: block;
      overflow-x: auto;
    }

    .action-links {
      flex-direction: column;
      gap: 0.5rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <div class="quizzes-container">
    <div class="quizzes-header">
      <h1 class="quizzes-title">My Created Quizzes</h1>
      <p>{{ quizzes|length }} quiz(es) created</p>
    </div>

    {% if quizzes %}
    <table class="quizzes-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Subject</th>
          <th>Status</th>
          <th>Time Period</th>
          <th>Duration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for quiz in quizzes %}
        <tr>
          <td>{{ quiz.title }}</td>
          <td>
            {% if quiz.subject_name %}
            {{ quiz.subject_name }}
            {% else %}
            Subject ID: {{ quiz.subject_id }}
            {% endif %}
          </td>
          <td>
            {% set now = datetime.datetime.now() %}
            {% if quiz.start_time > now %}
            <span class="quiz-status status-upcoming">Upcoming</span>
            {% elif quiz.end_time < now %} <span class="quiz-status status-ended">Ended</span>
              {% else %}
              <span class="quiz-status status-active">Active</span>
              {% endif %}
          </td>
          <td>
            <div><strong>Start:</strong> {{ quiz.start_time.strftime('%Y-%m-%d %H:%M') }}</div>
            <div><strong>End:</strong> {{ quiz.end_time.strftime('%Y-%m-%d %H:%M') }}</div>
          </td>
          <td>{{ quiz.duration }} minutes</td>
          <td>
            <div class="action-links" style="display: flex; gap: 1rem; align-items: center;">
              <a href="{{ url_for('doctor.quiz_results', quiz_id=quiz._id) }}" class="action-link"
                style="display: inline-flex; align-items: center; gap: 0.3rem;">
                <i class="fas fa-chart-bar"></i> Results
              </a>
              <a href="{{ url_for('doctor.export_quiz_results', quiz_id=quiz._id) }}" class="action-link"
                style="display: inline-flex; align-items: center; gap: 0.3rem;">
                <i class="fas fa-download"></i> Export
              </a>
              <form action="{{ url_for('doctor.delete_quiz', quiz_id=quiz._id) }}" method="post"
                style="display:inline;">
                <button type="submit"
                  onclick="return confirm('Are you sure you want to delete this quiz? This action cannot be undone.');"
                  style="
              background: none;
              border: none;
              padding: 0;
              cursor: pointer;
              color: #4a6fa5;
              font-weight: 500;
              display: inline-flex;
              align-items: center;
              gap: 0.3rem;
              font-family: inherit;
              font-size: inherit;
              text-decoration: none;
            ">
                  <i class="fas fa-trash-alt"></i> Delete
                </button>
              </form>
            </div>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-quizzes">
      <div class="empty-icon">
        <i class="fas fa-tasks"></i>
      </div>
      <h3>No quizzes created yet</h3>
      <p>Create your first quiz to get started</p>
    </div>
    {% endif %}

    <div style="text-align: center;">
      <a href="{{ url_for('doctor.dashboard') }}" class="back-link">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rows = document.querySelectorAll('.quizzes-table tbody tr');
    rows.forEach(row => {
      row.style.cursor = 'pointer';
      row.addEventListener('click', function (e) {
        if (e.target.tagName === 'A' || e.target.closest('a')) {
          return;
        }

        const resultsLink = this.querySelector('a[href*="quiz_results"]');
        if (resultsLink) {
          window.location.href = resultsLink.href;
        }
      });
    });
  });
</script>
{% endblock %}